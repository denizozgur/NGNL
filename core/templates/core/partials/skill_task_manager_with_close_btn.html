      
<!-- FILE: core/templates/core/partials/skill_task_manager_with_close_btn.html (Corrected) -->
<div>
    <!-- The "Close" button, which fetches the original "Manage Tasks" button -->
    <button
        hx-get="{% url 'get_manage_tasks_button' skill.id %}"
        hx-target="#skill-manager-button-{{ skill.id }}"
        hx-swap="innerHTML"
        class="mb-3 w-full text-center bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded"
    >
        Close
    </button>
    
    <!-- This div contains the actual manager UI -->
    <div class="bg-gray-50 p-4 rounded-b-lg border-t border-gray-200">
        <h4 class="text-md font-semibold text-gray-800 mb-3">Task Associations</h4>

        <!-- LINKED TASKS -->
        <div class="mb-4">
            <h5 class="text-sm font-bold text-green-700 mb-2">Linked Tasks</h5>
            <div class="space-y-2">
                {% for task in linked_tasks %}
                    <div class="flex justify-between items-center bg-green-100 p-2 rounded-md">
                        <span>{{ task.name }}</span>
                        <button 
                            hx-post="{% url 'disassociate_task_from_skill' skill.id task.id %}"
                            hx-target="closest .bg-gray-50"
                            hx-swap="outerHTML"
                            hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
                            class="text-sm bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600">
                            Remove
                        </button>
                    </div>
                {% empty %}
                    <p class="text-sm text-gray-500 italic">No tasks are linked to this skill yet.</p>
                {% endfor %}
            </div>
        </div>

        <!-- UNLINKED TASKS -->
        <div>
            <h5 class="text-sm font-bold text-blue-700 mb-2">Available Tasks to Link</h5>
            <div class="space-y-2">
                {% for task in unlinked_tasks %}
                    <div class="flex justify-between items-center bg-blue-100 p-2 rounded-md">
                        <span>{{ task.name }}</span>
                        <button
                            hx-post="{% url 'associate_task_to_skill' skill.id task.id %}"
                            hx-target="closest .bg-gray-50"
                            hx-swap="outerHTML"
                            hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
                            class="text-sm bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600">
                            Add
                        </button>
                    </div>
                {% empty %}
                    <p class="text-sm text-gray-500 italic">No other tasks are available to be linked.</p>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

    